
@{
    ViewBag.Title = "招待报销";
    Layout = "~/Areas/Expense/Views/Shared/_Layout.cshtml";
    List<Reception> list = ViewBag.List;
    List<Company> companys = ViewBag.Companys;
    List<Company> companys2 = ViewBag.Companys2;
    List<Project> projects = ViewBag.Projects;
    ReceptionParameter parameter = ViewBag.Parameter;
    int serial = 1;
}


<div class="row">
    <div class="col-xs-3">
        <div class="ibox float-e-margins">
            <div class="ibox-content mailbox-content">
                <h2>查询设置</h2>
                <form method="get">
                    <div class="form-group">
                        <label class="control-label">报销单位：</label>
                        <select class="form-control chosen-select" name="CompanyId">
                            <option value="" @(parameter.CompanyId.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (var company in companys)
                        {
                            <option value="@(company.ID)" @(parameter.CompanyId.HasValue && company.ID == parameter.CompanyId.Value ? "selected=selected" : "")>@(company.Name)</option>
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">项目：</label>
                        <select class="form-control chosen-select" name="ProjectId">
                            <option value="" @(parameter.ProjectId.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (var project in projects)
                        {
                            <option value="@(project.ID)" @(parameter.ProjectId.HasValue && parameter.ProjectId.Value == project.ID ? "selected=selected" : "")>@(project.Name)</option>
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">招待单位：</label>
                        <select class="form-control chosen-select" name="CompanyId2">
                            <option value="" @(parameter.CompanyId2.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (var company in companys2)
                        {
                            <option value="@(company.ID)" @(parameter.CompanyId2.HasValue && parameter.CompanyId2.Value == company.ID ? "selected=selected" : "")>@(company.Name)</option>
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">备注：</label>
                        <textarea class="form-control" rows="3" name="Content">@(parameter.Content)</textarea>
                    </div>
                    <div class="form-group">
                        <label class="control-label">状态：</label>
                        <div class="radio-inline i-checks">
                            <label><input type="radio" name="Delete" value="" @(parameter.Delete.HasValue ? "" : "checked=checked") />全部</label>
                        </div>
                        <div class="radio-inline i-checks">
                            <label><input type="radio" name="Delete" value="false" @(parameter.Delete.HasValue && parameter.Delete.Value == false ? "checked=checked" : "") />有效</label>
                        </div>
                        <div class="radio-inline i-checks">
                            <label><input type="radio" name="Delete" value="true" @(parameter.Delete.HasValue && parameter.Delete.Value == true ? "checked=checked" : "") />无效</label>
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i>查询</button>
                        <button type="button" class="btn btn-white" onclick="history.back()"><i class="fa fa-arrow-left"></i>返回</button>
                    </div>
                    <div class="clearfix"></div>
                </form>
            </div>
        </div>
        <div class="ibox">
            <div class="ibox-content">
                <h5>本页报销合计金额</h5>
                <h1 class="no-margins">&yen; @(list.Sum(e => e.Sheet.Money))元</h1>
            </div>
        </div>
    </div>
    <div class="col-xs-9 animated fadeInRight">
        <div class="ibox-content">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" class="text-center">序号</th>
                        <th rowspan="2" class="text-center">单号</th>
                        <th rowspan="2" class="text-center">报销单位</th>
                        <th rowspan="2" class="text-center">项目</th>
                        <th rowspan="2" class="text-center">报销时间</th>
                        <th rowspan="2" class="text-center">报销金额【元】</th>
                        <th colspan="4" class="text-center">招待详情</th>
                        <th rowspan="2" class="text-center">状态</th>
                    </tr>
                    <tr>
                        <th class="text-center">招待单位</th>
                        <th class="text-center">招待人数</th>
                        <th class="text-center">招待人员</th>
                        <th class="text-center">招待内容</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach(var item in list)
                    {
                        <tr>
                            <td class="text-center">@(serial++)</td>
                            <td class="text-center">
                                <a href="/Expense/Reception/Detail?sheetId=@(item.Sheet.ID)">@(item.Sheet.SerialNumber)</a>
                            </td>
                            <td class="text-center">@(item.Sheet.Company.Name)</td>
                            <td class="text-center">
                                @(item.Sheet.Project.Name)
                            </td>
                            <td class="text-center">@(item.Sheet.Time.ToString("yyyy/MM/dd"))</td>
                            <td>@(item.Sheet.Money)</td>
                            <td class="text-center">
                                @if (item.Companys != null)
                                {
                                    <ul>
                                        @foreach(var company in item.Companys)
                                        {
                                            <li>@(company.Name)</li>
                                        }
                                    </ul>
                                }
                            </td>
                            <td class="text-center">@(item.Number)</td>
                            <td class="text-center">
                                @if (item.Users != null)
                                {
                                   <ul>
                                       @foreach(var user in item.Users)
                                       {
                                           <li>@(user.Name)</li>
                                       }
                                   </ul>
                                }
                            </td>
                            <td class="text-center">
                                @if (item.Items != null)
                                {
                                    <ul>
                                        @foreach(var it in item.Items)
                                        {
                                            <li>@string.Format("内容：{0}；金额：{1}；支付方式：{2}",it.Content,it.Cost,it.PayWay.GetDescription())</li>
                                        }
                                    </ul>
                                }
                            </td>
                            <td class="text-center">
                                @if (item.Sheet.Delete == true)
                                {
                                    <span class="badge badge-danger"><i class="fa fa-ban"></i>无效</span>
                                }
                                else
                                {
                                    <span class="badge badge-info"><i class="fa fa-flag"></i>有效</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @{
                Html.RenderPartial("_pagination", parameter.Page as object);
            }
        </div>
    </div>
</div>

