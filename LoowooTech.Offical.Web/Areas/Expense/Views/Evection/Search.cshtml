
@{
    ViewBag.Title = "出差报销";
    Layout = "~/Areas/Expense/Views/Shared/_Layout.cshtml";
    List<Evection> list = ViewBag.List;
    EvectionParameter parameter = ViewBag.Parameter;
    List<Company> companys = ViewBag.Companys;
    List<Project> projects = ViewBag.Projects;
    List<City> citys = ViewBag.Citys;
    if (parameter.CityId.HasValue)
    {
        ViewBag.CityIds = new int[] { parameter.CityId.Value };
    }
    int serial = 1;
}


<div class="row">
    <div class="col-xs-3">
        <div class="ibox float-e-margins">
            <div class="ibox-content mailbox-content">
                <h2>查询设置</h2>
                <form method="get">
                    <div class="form-group">
                        <label class="control-label">报销单位：</label>
                        <select class="form-control chosen-select" name="CompanyId">
                            <option value="" @(parameter.CompanyId.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (var company in companys)
                        {
                            <option value="@(company.ID)" @(parameter.CompanyId.HasValue && company.ID == parameter.CompanyId.Value ? "selected=selected" : "")>@(company.Name)</option>
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">项目：</label>
                        <select class="form-control chosen-select" name="ProjectId">
                            <option value="" @(parameter.ProjectId.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (var project in projects)
                        {
                            <option value="@(project.ID)" @(parameter.ProjectId.HasValue && parameter.ProjectId.Value == project.ID ? "selected=selected" : "")>@(project.Name)</option>
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">出差城市：</label>
                        <select class="form-control chosen-select" name="CityId">
                            <option value="" @(parameter.CityId.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (var city in citys)
                        {
                            <option value="@(city.ID)" @(parameter.CityId.HasValue && parameter.CityId.Value == city.ID ? "selected=selected" : "")>@(city.Name)</option>
                        if (city.Children != null)
                        {
                            city.ParentName = city.Name;
                            Html.RenderPartial("SelectCity", city as object);
                        }
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">交通工具：</label>
                        <select class="form-control chosen-select" name="Vehicles">
                            <option value="" @(parameter.Vehicales.HasValue ? "" : "selected=selected")>全部</option>
                            @foreach (Vehicles vehicle in Enum.GetValues(typeof(Vehicles)))
                        {
                            <option value="@(vehicle)" @(parameter.Vehicales.HasValue && parameter.Vehicales.Value == vehicle ? "selected=selected" : "")>@(vehicle.GetDescription())</option>
                    }
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="control-label">备注：</label>
                        <textarea class="form-control" rows="3" name="Content">@(parameter.Content)</textarea>
                    </div>
                    <div class="form-group">
                        <label class="control-label">状态：</label>
                        <div class="radio-inline i-checks">
                            <label><input type="radio" name="Delete" value="" @(parameter.Delete.HasValue ? "" : "checked=checked") />全部</label>
                        </div>
                        <div class="radio-inline i-checks">
                            <label><input type="radio" name="Delete" value="false" @(parameter.Delete.HasValue && parameter.Delete.Value == false ? "checked=checked" : "") />有效</label>
                        </div>
                        <div class="radio-inline i-checks">
                            <label><input type="radio" name="Delete" value="true" @(parameter.Delete.HasValue && parameter.Delete.Value == true ? "checked=checked" : "") />无效</label>
                        </div>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-primary"><i class="fa fa-search"></i>查询</button>
                        <button type="button" class="btn btn-white" onclick="history.back()"><i class="fa fa-arrow-left"></i>返回</button>
                    </div>
                    <div class="clearfix"></div>
                </form>
            </div>
        </div>
        <div class="ibox">
            <div class="ibox-content">
                <h5>本页报销合计金额</h5>
                <h1 class="no-margins">&yen; @(list.Sum(e => e.Sheet.Money))元</h1>
            </div>
        </div>
    </div>
    <div class="col-xs-9 animated fadeInRight">
        <div class="ibox-content">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th rowspan="2" class="text-center">序号</th>
                        <th rowspan="2" class="text-center">单号</th>
                        <th rowspan="2" class="text-center">报销单位</th>
                        <th rowspan="2" class="text-center">项目</th>
                        <th rowspan="2" class="text-center">报销时间</th>
                        <th rowspan="2" class="text-center">报销金额【元】</th>
                        <th colspan="4" class="text-center">出差详情</th>
                        <th rowspan="2" class="text-center">时间</th>
                        <th rowspan="2" class="text-center">交通</th>
                        <th rowspan="2" class="text-center">状态</th>
                    </tr>
                    <tr>
                        <th class="text-center">出差城市</th>
                        <th class="text-center">住宿【元】</th>
                        <th class="text-center">其他</th>
                        <th class="text-center">其他金额【元】</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach(var item in list)
                    {
                        <tr>
                            <td class="text-center">@(serial++)</td>
                            <td class="text-center">
                                <a href="/Expense/Evection/Detail?sheetId=@(item.Sheet.ID)">@(item.Sheet.SerialNumber)</a>
                            </td>
                            <td>@(item.Sheet.Company.Name)</td>
                            <td class="text-center">@(item.Sheet.Project.Name)</td>
                            <td class="text-center">@(item.Sheet.Time.ToString("yyyy/MM/dd"))</td>
                            <td class="text-center">@(item.Sheet.Money)</td>
                            <td class="text-center">
                                @if (item.Citys != null)
                                {
                                    foreach (var city in item.Citys)
                                    {
                                        <span class="badge badge-info">@(city.LongName)</span>
                                    }
                                }
                            </td>
                            <td class="text-center">@(item.Hotel)</td>
                            <td>@(item.Other)</td>
                            <td>@(item.Fee)</td>
                            <td class="text-center">
                                @if (item.Errands != null)
                                {
                                    <ul>
                                        @foreach(var errand in item.Errands)
                                        {
                                            <li>@(errand.Description)</li>
                                        }
                                    </ul>
                                }
                            </td>
                            <td class="text-center">
                                @if (item.Traffics != null)
                                {
                                    <ul>
                                        @foreach(var traffic in item.Traffics)
                                        {
                                            <li>@(traffic.Vehicles.GetDescription()): @(traffic.Description)</li>
                                        }
                                    </ul>
                                }
                            </td>
                            <td class="text-center">
                                @if (item.Sheet.Delete == true)
                                {
                                    <span class="badge badge-danger"><i class="fa fa-ban"></i>无效</span>
                                }
                                else
                                {
                                    <span class="badge badge-info"><i class="fa fa-flag"></i>有效</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            @{
                Html.RenderPartial("_pagination", parameter.Page as object);
            }
        </div>
    </div>
</div>

